# Generated by Chef for <%= node[:fqdn] %>
# Local modifications will be overwritten.

/<%= @farm_name %>
{
    /clientheaders
    {
        <% @client_headers.each do |hdr| %>
        "<%= hdr %>"
        <% end %>
    }
    /virtualhosts
    {
        <% @virtual_hosts.each do |host| %>
        "<%= host %>"
        <% end %>
    }
    /renders
    {
        <% @renders.each do |render| %>
        /<%= render[:name] %>
        {
            /hostname "<%= render[:hostname] %>"
            /port "<%= render[:port] %>"
            /timeout "<%= render[:timeout] %>"
        }
        <% end %>
    }
    /filter
    {
        <% @filter_rules.keys.sort.each do |rule_number| %>
        /<%= rule_number %> { <%= @filter_rules[rule_number] %> }
        <% end %>

        # content
        /1000 { /type "allow" /glob "GET /*.html* *" }
        /1001 { /type "allow" /glob "GET /libs/granite/csrf/token.json *" }
        /1002 { /type "allow" /glob "GET * *.jpeg *" }
        /1003 { /type "allow" /glob "GET * *.woff* *" }
    }
    /cache
    {
        /allowAuthorized "1"
        /docroot "<%= @cache_root %>"
        <% @cache_opts.each do |opt| %>
        <%= opt %>
        <% end %>
        /rules
        {
            <% @cache_rules.keys.sort.each do |rule_number| %>
            /<%= rule_number %>
            {
                /glob "<%= @cache_rules[rule_number][:glob] %>"
                /type "<%= @cache_rules[rule_number][:type] %>"
            }
            <% end %>
            # aba content
            /1001
            {
                /glob "/libs/granite/csrf/token.json"
                /type "deny"
            }
        }
        /invalidate
        {
            <% @invalidation_rules.keys.sort.each do |rule_number| %>
            /<%= rule_number %>
            {
                /glob "<%= @invalidation_rules[rule_number][:glob] %>"
                /type "<%= @invalidation_rules[rule_number][:type] %>"
            }
            <% end %>
        }
        /allowedClients
        {
            <% @allowed_clients.keys.sort.each do |rule_number| %>
            /<%= rule_number %>
            {
                /glob "<%= @allowed_clients[rule_number][:glob] %>"
                /type "<%= @allowed_clients[rule_number][:type] %>"
            }
            <% end %>
        }
        /ignoreUrlParams
        {
            <% @ignore_url_params.keys.sort.each do |rule_number| %>
            /<%= rule_number %>
            {
                /glob "<%= @ignore_url_params[rule_number][:glob] %>"
                /type "<%= @ignore_url_params[rule_number][:type] %>"
            }
            <% end %>
        }
    }
    /statistics
    {
        /categories
        {
            <% @statistics.each do |category| %>
            /<%= category[:name] %>
            {
                /glob "<%= category[:glob] %>"
            }
            <% end %>
        }
    }
    <% if @enable_session_mgmt then %>
    /sessionmanagement
    {
        <% @session_mgmt.keys.each do |key| %>
        /<%= key %> "<%= @session_mgmt[key] %>"
        <% end %>
    }
    <% end %>
}
